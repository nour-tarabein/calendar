<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Calendar</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.2/main.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">My Calendar</h1>
        <div class="row">
            <div class="col-lg-6 offset-lg-3">
                <form id="addEventForm" class="mb-3">
                    <div class="mb-3">
                        <label for="date" class="form-label">Date:</label>
                        <input type="date" id="date" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="event" class="form-label">Event:</label>
                        <input type="text" id="event" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Event</button>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8 offset-lg-2">
                <div id="calendar"></div>
            </div>
        </div>
    </div>

    
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.2/main.min.js"></script>
    <script>
document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridWeek', // or 'timeGridDay'
        events: '/get-events',
        selectable: true,
        droppable: true,
        editable: true,
        eventClick: handleEventClick,
        select: handleDateSelect, // Add this line
        eventContent: function (arg) {
            let title = document.createElement('p');
            title.innerHTML = arg.event.title;

            let editButton = document.createElement('button');
            editButton.innerHTML = 'Edit';
            editButton.addEventListener('click', function (event) {
                event.stopPropagation();
                handleEditEvent(arg.event);
            });

            let deleteButton = document.createElement('button');
            deleteButton.innerHTML = 'Delete';
            deleteButton.addEventListener('click', function (event) {
                event.stopPropagation();
                handleDeleteEvent(arg.event);
            });

            let container = document.createElement('div');
            container.appendChild(title);
            container.appendChild(editButton);
            container.appendChild(deleteButton);

            let arrayOfDomNodes = [container];
            return { domNodes: arrayOfDomNodes };
        }
    });

    calendar.render();

    document.getElementById('addEventForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const date = document.getElementById('date').value;
        const eventText = document.getElementById('event').value;

        fetch('/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ date: date, event: eventText }),
        })
            .then((response) => response.json())
            .then((data) => {
                calendar.refetchEvents();
            })
            .catch((error) => {
                console.error('Error:', error);
            });

        document.getElementById('date').value = '';
        document.getElementById('event').value = '';
    });

    function handleEventClick(info) {
        handleEditEvent(info.event);
    }

    function handleEditEvent(event) {
        const newEventText = prompt('Enter the new event text:', event.title);
        if (newEventText) {
            fetch(`/update/${event.id}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ date: event.start, event: newEventText }),
            })
                .then((response) => response.json())
                .then((data) => {
                    calendar.refetchEvents();
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
    }

    function handleDeleteEvent(event) {
        if (confirm('Are you sure you want to delete this event?')) {
            fetch(`/delete/${event.id}`, {
                method: 'DELETE',
            })
                .then((response) => response.json())
                .then((data) => {
                    calendar.refetchEvents();
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
    }

    function handleDateSelect(info) { // Add this function
        const eventText = prompt('Enter the event text:');
        if (eventText) {
            fetch('/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ date: info.startStr, event: eventText }),
            })
                .then((response) => response.json())
                .then((data) => {
                    calendar.refetchEvents();
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
    }
});



    </script>
</body>
</html>
